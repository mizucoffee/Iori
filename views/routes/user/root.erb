<!DOCTYPE html>
<html lang="jp">

<head>
    <%= render :erb ,:'template/head' %>
</head>

<body>
    <%= render :erb ,:'template/header' %>
    <%= render :erb ,:'template/title', :locals => {title: 'ユーザー検索', file: 'images/user.jpg', pos: '25%'}%>

    <div id="user-search" class="uk-section">
        <div class="uk-container uk-text-center">
            <form class="uk-form-width-large uk-text-left" action="/user">
                <div class="uk-margin">
                    <label class="uk-form-label text" for="form-title">ID</label>
                    <div class="uk-form-controls">
                        <input class="uk-input" value="<%= @q unless @q.blank? %>" type="text" name="q"
                            placeholder="ユーザー名 or @userid">
                    </div>
                </div>

                <input class="uk-button uk-button-primary uk-align-center" value="検索" type="submit">
            </form>
        </div>
        <div class="uk-container uk-container-xsmall uk-text-center">
            <% unless @q.blank? %>
            <% if @users.length > 0 %>
            <table class="uk-table uk-table-striped uk-table-middle">
                <tr>
                    <th class="uk-text-center">アイコン</th>
                    <th class="uk-text-center">ユーザー名</th>
                    <th class="uk-text-center">Twitter ID</th>
                    <th class="uk-text-center">レビュー数</th>
                </tr>
                <% twuser = Tw.app.users(@users.map{|a|a.twitter_id.to_i})%>
                <% twuser.each do |u| %>
                <tr>
                    <td><img class="user-icon" src="<%= u.profile_image_url_https %>" alt=""></td>
                    <td><a href="/@<%= u.screen_name %>"><%= u.name %></a></td>
                    <td><a href="//twitter.com/<%= u.screen_name %>">@<%= u.screen_name %></a></td>
                    <td><%= User.find_by(twitter_id: u.id).reviews.count %></td>
                </tr>
                <% end %>
            </table>
            <% else %>
            見つかりませんでした。
            <% end %>
            <% end %>
        </div>

    </div>
    <%= render :erb ,:'template/footer' %>
</body>

</html>